@using Microsoft.AspNetCore.Identity
@inject UserManager<User> _userManager

@model IEnumerable<Pin>

<div class="container">
        <table class='table table-striped'>
            <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Rating</th>
                <th>Comment</th>
                <th>Image</th>
                <th>Actions</th>
                <th>UserId</th>
            </tr>
            <p>Logged in User ID: @_userManager.GetUserId(User)</p>
            @foreach (var pin in Model)    
            {
                if(pin.UserId == _userManager.GetUserId(User))
                {
                    <tr class="pin-row" 
                    data-id="@pin.PinId" 
                    data-name="@pin.Name" 
                    data-date="@pin.DateCreated" 
                    data-rating="@pin.Rating" 
                    data-comment="@pin.Comment" 
                    data-image="@pin.ImageUrl"
                    data-latitude="@pin.Latitude" 
                    data-longitude="@pin.Longitude"
                    data-userid="@pin.UserId">
                    
                    <td>@pin.DateCreated</td>
                    <td>
                        <a asp-controller="Pin" 
                         asp-action="Details" 
                         asp-route-id="@pin.PinId">@pin.Name</a>
                    </td>
                    <td>@pin.Rating.ToString("")</td>
                    <td>@pin.Comment</td>
                    <td>
                        <img src="@pin.ImageUrl" alt="Item Image" style="max-width: 80px; max-height: 80px;"/>
                    </td>
                    <td>
                        <a asp-action="Update" asp-route-id="@pin.PinId">Update</a>
                        <a asp-action="Delete" asp-route-id="@pin.PinId">Delete</a>
                    </td>
                     <td>@pin.UserId</td>
                </tr>
                }
            }
        </table>
    
    </div>

<script>
// code to selected items in the list
    document.querySelectorAll('.pin-row').forEach(row => {
        row.addEventListener('click', function () {
            // Remove the 'selected' class from all rows
            document.querySelectorAll('.pin-row').forEach(r => r.classList.remove('selected'));

            // Add the 'selected' class to the clicked row
            this.classList.add('selected');

           // Stores location data from selected pin
            var latitude = this.getAttribute('data-latitude');
            var longitude = this.getAttribute('data-longitude');
            
            //sets location data
            sessionStorage.setItem('Lat', latitude);
            sessionStorage.setItem('Long', longitude);
            
            //updates map and sets the pointer to location
            map.setView([latitude, longitude], 13);
             popup.setLatLng([latitude, longitude]).setContent("You selected the pin at " + latitude + ", " + longitude).openOn(map);
        });
    });
</script>

<style>
    /* Optional CSS to visually highlight the selected row */
    .selected {
        background-color: #e0e0e0; /* Light gray background */
    }
</style>