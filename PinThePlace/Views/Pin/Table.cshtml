@model PinsViewModel


<div class="container">
    <div class="row">
        
        <!-- første kolonne -->

        <div class="col-md-6 ">
            <h3>Find your place</h3>
            <!--inputing google maps-->
            <div id="map" style="height: 750px; width: 100%;"></div>
            <!--temporary picture-->

            <!--- <img src="~/images/map.png" alt="Map Image"> -->
                 <p>
             <!--Mekanisme for å lage ny data entry CRUD-->
            <a id="add_a_pin" class="btn addpinButton"
                asp-controller="Pin"
                asp-action="Create"> Add a pin</a>
        </p>
        </div>

        <!--andre kolonne-->

        <div class="col-md-6">
            <!--lenker til feed og mypins-->
            <div>
                <button autofocus id="showFeedWindow" class="feedButton btn btn-lg">Feed</button>
                <button id="showFavWindow" class="mypinsButton btn btn-lg">My Pins</button>
            </div>
            <!--Feed vindu-->
            <div id="feedwindow" class="contentwindow" >
                <partial name="_Feed" model="Model.Pins"/>
            </div>
            <!--mypins vindu-->
            <div id="favwindow" class="contentwindow" style="display: none;">
                <partial name="_MyPins" model="Model.Pins"/>
            </div>
        </div>
    </div>
</div>
<script src="~/js/jquery.min.js"></script>
<script src="~/js/bootstrap.min.js"></script>

<script>
  
$(document).ready(function() {
    
    $('#showFeedWindow').focus();

    // Select the first card when entering the page
    var firstCard = document.querySelector('.cardFeed');

    // Add the 'active' class to the first card
    if (firstCard) {
        firstCard.classList.add('active');
    }

    // Code for switching between windows and switching background color
    $("#showFeedWindow").click(function(e){
        e.preventDefault();
        $("#feedwindow").show();
        $("#favwindow").hide();
        $("#favwindow").removeClass("contentwindow2").addClass("contentwindow");
        // Remove 'active' class from cards in feed
    document.querySelectorAll('.cardFeed').forEach(c => c.classList.remove('active'));

    });

    $("#showFavWindow").click(function(e){
        e.preventDefault();
        $("#favwindow").show();
        $("#feedwindow").hide();
        $("#favwindow").removeClass("contentwindow").addClass("contentwindow2"); 
        // Remove 'active' class from cards in feed
    document.querySelectorAll('.cardMypins').forEach(c => c.classList.remove('active'));

    });

    // Code for selecting items in the list cardFeed
    document.querySelectorAll('.cardFeed').forEach(card => {
        card.addEventListener('click', function () {
            // Remove the 'selected' class from all rows
            document.querySelectorAll('.cardFeed').forEach(c => c.classList.remove('active'));

            // Add the 'selected' class to the clicked row
            this.classList.add('active');
        });
    });
    // Code for selecting items in the list cardMypins
    document.querySelectorAll('.cardMypins').forEach(card => {
        card.addEventListener('click', function () {
            // Remove the 'selected' class from all rows
            document.querySelectorAll('.cardMypins').forEach(c => c.classList.remove('active'));

            // Add the 'selected' class to the clicked row
            this.classList.add('active');
        });
    });
});
window.onload = function() {
    // Select the first card when entering the page
    var firstCard = document.querySelector('.card');

    // Add the 'active' class to the first card
    if (firstCard) {
        firstCard.classList.add('active');
    }
};

// for å få kart inn i div med map id
/*function initMap() {
    var mapOptions = {
        zoom: 8,
        center: { lat: -34.397, lng: 150.644 }, 
    };
    var map = new google.maps.Map(document.getElementById('map'), mapOptions);
} */
</script>

<script>
    //Adding the map 
    var map = L.map('map').setView([59.9139,10.7522],13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    const provider = new GeoSearch.OpenStreetMapProvider();

    const searchControl = new GeoSearch.GeoSearchControl({
    provider: provider,
    showMarker: true,
    showPopup: false,
    marker: {
        icon: new L.Icon.Default(),
        draggable: false,
    },
    popupFormat: ({ query, result }) => result.label,
    maxMarkers: 1,
    retainZoomLevel: false,
    animateZoom: true,
    autoClose: true,
    searchLabel: 'Enter address',
    keepResult: true
    });

    map.addControl(searchControl);



    //Makes a pop up that shows the clicked places' latitude and longitude 
    var currentMarker = null;


    function onMapClick(e) {
        var lat = e.latlng.lat.toFixed(6);
        var long = e.latlng.lng.toFixed(6);

        if (currentMarker){
            map.removeLayer(currentMarker);
        }
        currentMarker = L.marker(e.latlng).addTo(map);
    
        
        sessionStorage.setItem('Lat',lat);
        sessionStorage.setItem('Long',long);

        //document.getElementById("latitude").value = lat;
       // document.getElementById("Longitude").value = long;
    }
    map.on('click',onMapClick);

    map.on('geosearch/showlocation', function(e) {
        if (e.location){
            var lat = e.location.y;
            var long = e.location.x;

            if (currentMarker){
                map.removeLayer(currentMarker);
            }
            currentMarker = L.marker([lat,long]).addTo(map);
    
            sessionStorage.setItem('Lat',lat);
            sessionStorage.setItem('Long',long);

            console.log('GeoSearch location:', lat, long);
            console.log('sessionStorage after GeoSearch:', sessionStorage);
        } else {
            console.error("location null");
        }
    });

    document.getElementById('add_a_pin').addEventListener('click', function(e) {
    var lat = sessionStorage.getItem('Lat');
    var long = sessionStorage.getItem('Long');

    if (!lat || !long) {
        e.preventDefault();
        alert('Please click on the map first before trying to add a pin!.');
    }
});
</script>


<!--hente kart med API key fra Google maps-->

<!--<script async 
    src="https://maps.googleapis.com/maps/api/js?key=  YOUR_API_KEY   &callback=initMap">
</script>-->
